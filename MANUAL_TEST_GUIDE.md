# Manual Testing Guide - Cancellation Handling

**æ¸¬è©¦æ—¥æœŸï¼š** 2025-10-01
**æ¸¬è©¦ç‰ˆæœ¬ï¼š** v1.1 (å«å–æ¶ˆè™•ç†)

---

## ğŸ“‹ æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### æƒ…å¢ƒ 1ï¼šç”¨æˆ¶åœ¨ PayPal é é¢é»æ“Šå–æ¶ˆ âœ…

**æ¸¬è©¦æ­¥é©Ÿï¼š**
1. é–‹å•Ÿ `http://localhost:8502`
2. è¨­å®šé‡‘é¡ $10.00 USD
3. é»æ“Šã€ŒPay $10.00 USDã€æŒ‰éˆ•
4. PayPal popup é–‹å•Ÿå¾Œï¼Œé»æ“Šã€ŒCancel and return to...ã€é€£çµ
5. è§€å¯Ÿçµæœ

**é æœŸè¡Œç‚ºï¼š**
- âœ… Popup è‡ªå‹•é—œé–‰
- âœ… é¡¯ç¤ºè¨Šæ¯ï¼šã€Œâš ï¸ You cancelled the payment on PayPalã€
- âœ… é¡¯ç¤ºã€ŒğŸ”„ Retry Paymentã€æŒ‰éˆ•
- âœ… Backend æ¸…ç† `st.session_state.paypal_pending_orders`
- âœ… è¨˜éŒ„åˆ° `st.session_state.cancelled_payments`ï¼ˆreason: `user_cancelled`ï¼‰

**å¯¦éš›çµæœï¼š**
[ ] é€šé / [ ] å¤±æ•—

**å‚™è¨»ï¼š**


---

### æƒ…å¢ƒ 2ï¼šç”¨æˆ¶æ‰‹å‹•é—œé–‰ Popup âœ…

**æ¸¬è©¦æ­¥é©Ÿï¼š**
1. é–‹å•Ÿ `http://localhost:8502`
2. è¨­å®šé‡‘é¡ $10.00 USD
3. é»æ“Šã€ŒPay $10.00 USDã€æŒ‰éˆ•
4. PayPal popup é–‹å•Ÿå¾Œï¼Œç›´æ¥é—œé–‰è¦–çª—ï¼ˆé» X æˆ–æŒ‰ ESCï¼‰
5. è§€å¯Ÿçµæœ

**é æœŸè¡Œç‚ºï¼š**
- âœ… Streamlit æª¢æ¸¬åˆ° popup é—œé–‰
- âœ… é¡¯ç¤ºè¨Šæ¯ï¼šã€Œâš ï¸ Payment window was closedã€
- âœ… é¡¯ç¤ºã€ŒğŸ”„ Retry Paymentã€æŒ‰éˆ•
- âœ… Backend æ¸…ç† pending order
- âœ… è¨˜éŒ„åˆ° cancelled_paymentsï¼ˆreason: `user_closed`ï¼‰

**å¯¦éš›çµæœï¼š**
[ ] é€šé / [ ] å¤±æ•—

**å‚™è¨»ï¼š**


---

### æƒ…å¢ƒ 3ï¼šä»˜æ¬¾è¶…æ™‚ï¼ˆ5 åˆ†é˜ï¼‰ â±

**æ¸¬è©¦æ­¥é©Ÿï¼š**
1. é–‹å•Ÿ `http://localhost:8502`
2. è¨­å®šé‡‘é¡ $10.00 USD
3. é»æ“Šã€ŒPay $10.00 USDã€æŒ‰éˆ•
4. PayPal popup é–‹å•Ÿå¾Œï¼Œ**ä¸åšä»»ä½•æ“ä½œ**
5. ç­‰å¾… 5 åˆ†é˜
6. è§€å¯Ÿçµæœ

**é æœŸè¡Œç‚ºï¼š**
- âœ… 5 åˆ†é˜å¾Œ popup è‡ªå‹•é—œé–‰
- âœ… é¡¯ç¤ºè¨Šæ¯ï¼šã€Œâš ï¸ Payment timed out (exceeded 5 minutes)ã€
- âœ… é¡¯ç¤ºã€ŒğŸ”„ Retry Paymentã€æŒ‰éˆ•
- âœ… Backend æ¸…ç† pending order
- âœ… è¨˜éŒ„åˆ° cancelled_paymentsï¼ˆreason: `timeout`ï¼‰

**å¯¦éš›çµæœï¼š**
[ ] é€šé / [ ] å¤±æ•—

**å‚™è¨»ï¼š**
âš ï¸ æ­¤æ¸¬è©¦éœ€ç­‰å¾… 5 åˆ†é˜ï¼Œå¯é¸æ“‡æ€§æ¸¬è©¦


---

### æƒ…å¢ƒ 4ï¼šæˆåŠŸä»˜æ¬¾ï¼ˆé©—è­‰æœªå—å½±éŸ¿ï¼‰ âœ…

**æ¸¬è©¦æ­¥é©Ÿï¼š**
1. é–‹å•Ÿ `http://localhost:8502`
2. è¨­å®šé‡‘é¡ $10.00 USD
3. é»æ“Šã€ŒPay $10.00 USDã€æŒ‰éˆ•
4. åœ¨ PayPal é é¢å®Œæˆä»˜æ¬¾
5. è§€å¯Ÿçµæœ

**é æœŸè¡Œç‚ºï¼š**
- âœ… ä»˜æ¬¾æˆåŠŸ
- âœ… é¡¯ç¤ºã€ŒğŸ‰ Payment Successful!ã€
- âœ… é¡¯ç¤ºè¨‚å–®è³‡è¨Šï¼ˆOrder ID, Status, Payer, Amountï¼‰
- âœ… **ä¸é¡¯ç¤ºå–æ¶ˆè¨Šæ¯**
- âœ… Backend æ­£å¸¸æ•ç²è¨‚å–®ä¸¦æ¸…ç† pending order

**å¯¦éš›çµæœï¼š**
[ ] é€šé / [ ] å¤±æ•—

**å‚™è¨»ï¼š**


---

## ğŸ” æª¢æŸ¥é …ç›®

### Backend ç‹€æ…‹æª¢æŸ¥

**æª¢æŸ¥ `st.session_state.paypal_pending_orders`ï¼š**
```python
# åœ¨ Streamlit app ä¸­æ·»åŠ è‡¨æ™‚ debug
with st.expander("ğŸ” Debug: Pending Orders"):
    st.json(st.session_state.get('paypal_pending_orders', {}))
```

**é æœŸï¼š**
- å–æ¶ˆå¾Œæ‡‰ç‚ºç©º `{}`
- ä»˜æ¬¾æˆåŠŸå¾Œæ‡‰ç‚ºç©º `{}`

---

### Frontend æ§åˆ¶å°æª¢æŸ¥

**é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰**

**æª¢æŸ¥é …ç›®ï¼š**
1. é»æ“Šä»˜æ¬¾æŒ‰éˆ•æ™‚ï¼Œconsole æ‡‰é¡¯ç¤ºï¼š
   ```
   authorization_url: https://www.sandbox.paypal.com/checkoutnow?token=XXX
   ```

2. å–æ¶ˆæ™‚ï¼Œcomponent æ‡‰è¿”å›ï¼š
   ```javascript
   {cancelled: true, reason: "user_cancelled", token: "XXX"}
   ```

3. æˆåŠŸä»˜æ¬¾æ™‚ï¼Œcomponent æ‡‰è¿”å›ï¼š
   ```javascript
   {token: "XXX", PayerID: "YYY"}
   ```

---

## ğŸ“Š æ¸¬è©¦çµæœçµ±è¨ˆ

| æƒ…å¢ƒ | ç‹€æ…‹ | åŸå› æª¢æ¸¬ | UI åé¥‹ | State æ¸…ç† |
|------|------|---------|---------|-----------|
| 1. PayPal å–æ¶ˆ | [ ] | [ ] | [ ] | [ ] |
| 2. æ‰‹å‹•é—œé–‰ | [ ] | [ ] | [ ] | [ ] |
| 3. è¶…æ™‚ | [ ] | [ ] | [ ] | [ ] |
| 4. æˆåŠŸä»˜æ¬¾ | [ ] | N/A | [ ] | [ ] |

---

## ğŸ› å·²çŸ¥å•é¡Œ

ï¼ˆæ¸¬è©¦ä¸­ç™¼ç¾çš„å•é¡Œè¨˜éŒ„æ–¼æ­¤ï¼‰

1.

---

## âœ… æ¸¬è©¦ç°½æ ¸

**æ¸¬è©¦äººå“¡ï¼š** _____________
**æ¸¬è©¦æ—¥æœŸï¼š** _____________
**æ¸¬è©¦çµæœï¼š** [ ] å…¨éƒ¨é€šé / [ ] éƒ¨åˆ†å¤±æ•—
**å‚™è¨»ï¼š**
